<!DOCTYPE html>
{% import "macros.html" as macros with context %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Arcanum Libri</title>
  <style>
    html { font-family: Georgia, "Nimbus Roman", serif; }
    header { margin: 300pt 0; }
    blockquote { font-style: italic; }
    section { margin-top: 60pt; }
    table { margin: 10pt; }
    a { color: maroon; }

    h1 {
      margin: 60pt 0;
      text-align: center;
    }

    .stats {
      display: flex;
      align-items: start;
    }

    .toc-columns {
      column-count: 3;
      width: fit-content;
    }

    .toc-columns a {
      display: block;
    }
  </style>
</head>
<body>

<h1>Arcanum Libri</h1>

<header>
  <blockquote>
    <p>
      This arrogance of theirs is nothing new;
      <br/>For once they used it at less secret gate,
      <br/>Which finds itself without a fastening still.
    </p>
    &mdash; Inferno Ⅷ
  </blockquote>

  Expect to be spoiled.
</header>

<nav>
  <h2>Mensa Contentorum</h2>
  <ol type="I">
    <li><a href="#methods">Breviarium</a></li>

    <li>
      <a href="#classes">Classes</a>
      <ol type="i">
        {% for tier in classes_by_tier.keys() %}
        <li><a href="#class_tier_{{tier.sequence}}">{{tier.name}}</a></li>
        {% endfor %}
      </ol>
    </li>

    <li><a href="#skills">Skills</a></li>
  </ol>
</nav>

<main>
  <section id="methods">
    <h2>Ⅰ. Breviarium</h2>
    <p>
      This document describes some mechanical bits in the online game
      <a href="https://mathiashjelm.gitlab.io/arcanum">Arcanum</a>.
      This is not intended as a general-purpose guide. It also makes no attempt to protect you from spoilers.
    </p>
    <p>
      This is a document generated by pulling data from the
      <a href="https://gitlab.com/mathiashjelm/arcanum">Arcanum repository</a>,
      from <a href="https://gitlab.com/mathiashjelm/arcanum/-/tree/{{branch}}">the {{branch}} branch</a>
      containing {{package["name"].title()}} ({{package["description"].title()}}) version {{package["version"]}}.
      A <a href="https://www.python.org">Python</a> script processes these data,
      and then fills out a
      <a href="https://jinja.palletsprojects.com/en/3.1.x">Jinja template</a>.
    </p>
    <p>
      Since this script operates somewhat "close to the metal", it doesn't always translate game code elements into
      legible form. For example, some references to <code>evt_helper</code> are left as-is even though that's actually
      an internal flag tracking the status of "job"-tier classes. For sanity-checking purposes, raw game data are shown
      beside the decoded text.
    </p>
  </section>

  <section id="classes">
    <h2>Ⅱ. Classes</h2>
    {% for tier, classes in classes_by_tier.items()  %}

    <section id="class_tier_{{tier.sequence}}">
      <h3>{{tier.name}} Classes</h3>
      {% if len(classes) > 1 %}

      <nav class="toc-columns">
        {% for class_ in classes %}
        <a href="#class_{{class_.id}}">{{class_.friendly_name}}</a>
        {% endfor %}
      </nav>
      {% endif %}
      {% for class_ in classes %}

      <section id="class_{{class_.id}}">
        <h4>
          {{class_.friendly_name}}
          {% if class_.secret %}
          (<em>secret</em>)
          {% endif %}
        </h4>
        {% if class_.buyname or class_.actdesc %}
        <p>&rightarrow; {{class_.buyname or ''}} {{class_.actdesc or ''}}</p>
        {% endif %}
        {% if class_.desc %}
        <p>{{class_.desc}}</p>
        {% endif %}
        {{- macros.require_fragments(class_.need,    class_.friendly_need,    'Needs') }}
        {{- macros.require_fragments(class_.require, class_.friendly_require, 'Requires') }}
        {%- if class_.flavor %}
        <p><em>{{class_.flavor}}</em></p>
        {% endif %}
        {% if class_.cost or class_.modifier_map or class_.result %}

        <div class="stats">
          {{- macros.stats_table(class_.cost, 'Cost') }}
          {{- macros.stats_table(class_.modifier_map, 'Modifiers') }}
          {{- macros.stats_table(class_.result, 'Result') }}
        </div>
        {% endif %}
        {% if class_.disabled_actions %}

        <p>Disables: {{class_.disabled_actions|join(", ")}}.</p>
        {% endif %}

        <details>
          <summary>Raw</summary>
          <pre><code>{{class_.formatted_raw}}</code></pre>
        </details>
      </section>
      {% endfor %}
    </section>
    {% endfor %}
  </section>

  <section id="skills">
    <h2>Ⅲ. Skills</h2>

  </section>
</main>

</body>
</html>