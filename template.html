<!DOCTYPE html>
{% import "macros.html" as macros with context %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Arcanum Libri</title>
  <style>
    html { font-family: Georgia, "Nimbus Roman", serif; }
    header { margin: 300pt 0; }
    blockquote { font-style: italic; }
    section { margin-top: 60pt; }
    table { margin: 10pt; }
    a { color: maroon; }

    h1 {
      margin: 60pt 0;
      text-align: center;
    }

    .stats {
      display: flex;
      align-items: start;
    }

    .toc-columns {
      column-count: 3;
      width: fit-content;
    }

    .toc-columns a {
      display: block;
    }
  </style>
</head>
<body>

<h1>Arcanum Libri</h1>

<header>
  <blockquote>
    <p>
      This arrogance of theirs is nothing new;
      <br/>For once they used it at less secret gate,
      <br/>Which finds itself without a fastening still.
    </p>
    &mdash; Inferno Ⅷ
  </blockquote>

  Expect to be spoiled.
</header>

<nav>
  <h2>Mensa Contentorum</h2>
  <ol type="I">
    <li><a href="#methods">Breviarium</a></li>

    <li>
      <a href="#tiers">Tiers</a>
      <ol type="i">
        {% for tier in tiers_by_id.values() %}
        <li><a href="#{{tier.permalink}}">{{tier.title}}</a></li>
        {% endfor %}
      </ol>
    </li>

    <li>
      <a href="#classes">Classes</a>
      <ol type="i">
        {% for tier in tiers_by_id.values() %}
        {% set classes = classes_by_tier.get(tier.id, ()) %}

        <li>
          <a href="#class_{{tier.permalink}}">{{tier.friendly_name}} Classes</a>
          <ul>
            {% for class_ in classes %}
            <li><a href="#{{class_.permalink}}">{{class_.friendly_name}}</a></li>
            {% endfor %}
          </ul>
        </li>
        {% endfor %}
      </ol>
    </li>

    <li>
      <a href="#skills">Skills</a>
      <ol type="i">
        {% for level, skills in skills_by_level.items() %}

        <li>
          <a href="#level_{{level}}_skills">{{level_name(level)}} Skills</a>

          <ul>
            {% for skill in skills %}
            <li><a href="#{{skill.permalink}}">{{skill.friendly_name}}</a></li>
            {% endfor %}
          </ul>
        </li>
        {% endfor %}
      </ol>
    </li>
  </ol>
</nav>

<main>
  <section id="methods">
    <h2>Ⅰ. Breviarium</h2>
    <p>
      This document describes some mechanical bits in the online game
      <a href="https://mathiashjelm.gitlab.io/arcanum">Arcanum</a>.
      This is not intended as a general-purpose guide. It also makes no attempt to protect you from spoilers.
    </p>
    <p>
      This is a document generated by pulling data from the
      <a href="https://gitlab.com/mathiashjelm/arcanum">Arcanum repository</a>,
      from <a href="https://gitlab.com/mathiashjelm/arcanum/-/tree/{{branch}}">the {{branch}} branch</a>
      containing {{package["name"].title()}} ({{package["description"].title()}}) version {{package["version"]}}.
      A <a href="https://www.python.org">Python</a> script processes these data,
      and then fills out a
      <a href="https://jinja.palletsprojects.com/en/3.1.x">Jinja template</a>.
      Only data from the core module are loaded; optional modules are omitted.
    </p>
    <p>
      Since this script operates somewhat "close to the metal", it doesn't always translate game code elements into
      legible form. For example, some references to <code>evt_helper</code> are left as-is even though that's actually
      an internal flag tracking the status of "job"-tier classes. For sanity-checking purposes, raw game data are shown
      beside the decoded text.
    </p>
  </section>

  <section id="tiers">
    <h2>Ⅱ. Tiers</h2>
    {% for tier in tiers_by_id.values() %}
    {% set classes = classes_by_tier.get(tier.id, ()) %}

    <section id="{{tier.permalink}}">
      <h3>{{tier.title}}</h3>
      {% if tier.event %}
      {% if tier.event.desc %}
      <p>{{tier.event.desc}}</p>
      {% endif %}
      {% if tier.event.require %}
      <p>Requires: {{tier.event.require}}</p>
      {% endif %}
      {% if tier.event.mod or tier.event.result %}

      <div class="stats">
        {{- macros.stats_table(tier.event.mod, 'Modifiers') }}
        {{- macros.stats_table(tier.event.result, 'Result') }}
      </div>
      {% endif %}
      {% if tier.event.disable %}

      <p>Disables: {{tier.event.disable|join(", ")}}.</p>
      {% endif %}
      {% set tier_locks = tier.event and tier.event.get_lock_tiers(index) %}
      {% if tier_locks %}

      <p>
        Locks:
        {% for tier_lock in tier_locks %}
        <a href="#{{tier_lock.permalink}}">{{tier_lock.friendly_name}}</a>
        {%- if loop.last %}.{% else %}, {% endif %}

        {% endfor %}
      </p>
      {% endif %}
      {% endif %}

      <h4>Classes</h4>
      <nav class="toc-columns">
        {% for class_ in classes %}
        <a href="#{{class_.permalink}}">{{class_.friendly_name}}</a>
        {% endfor %}
      </nav>
      {% if tier.event %}

      <details>
        <summary>Raw</summary>
        <pre><code>{{tier.event.formatted_raw}}</code></pre>
      </details>
      {% endif %}
    </section>
    {% endfor %}
  </section>

  <section id="classes">
    <h2>Ⅲ. Classes</h2>
    {% for tier in tiers_by_id.values() %}
    {% set classes = classes_by_tier.get(tier.id, ()) %}

    <section id="class_{{tier.permalink}}">
      <h3>{{tier.title}}</h3>
      {% for class_ in classes %}

      <section id="{{class_.permalink}}">
        <h4>
          {{class_.friendly_name}}
          {% if class_.secret %}
          (<em>secret</em>)
          {% endif %}
        </h4>
        {% if class_.buyname or class_.actdesc %}
        <p>&rightarrow; {{class_.buyname or ''}} {{class_.actdesc or ''}}</p>
        {% endif %}
        {% if class_.desc %}
        <p>{{class_.desc}}</p>
        {% endif %}
        {{- macros.require_fragments(class_.need,    class_.friendly_need,    'Needs') }}
        {{- macros.require_fragments(class_.require, class_.friendly_require, 'Requires') }}
        {%- if class_.id in class_deps %}
        <p>
          Unlocks:
          {% for dep in class_deps[class_.id] %}
          <a href="#{{dep.permalink}}">{{dep.friendly_name}}</a>
          {%- if loop.last %}.{% else %}, {% endif %}

          {% endfor %}
        </p>
        {% endif %}
        {% if class_.flavor %}
        <p><em>{{class_.flavor}}</em></p>
        {% endif %}
        {% if class_.cost or class_.modifier_map or class_.result %}

        <div class="stats">
          {{- macros.stats_table(class_.cost, 'Cost') }}
          {{- macros.stats_table(class_.modifier_map, 'Modifiers') }}
          {{- macros.stats_table(class_.result, 'Result') }}
        </div>
        {% endif %}
        {% if class_.disabled_actions %}

        <p>Disables: {{class_.disabled_actions|join(", ")}}.</p>
        {% endif %}

        <details>
          <summary>Raw</summary>
          <pre><code>{{class_.formatted_raw}}</code></pre>
        </details>
      </section>
      {% endfor %}
    </section>
    {% endfor %}
  </section>

  <section id="skills">
    <h2>Ⅳ. Skills</h2>
    {% for level, skills in skills_by_level.items() %}
    <section id="level_{{level}}_skills">
      <h3>{{level_name(level)}} Skills</h3>
      {% for skill in skills %}

      <section id="{{skill.permalink}}">
        <h4>{{skill.friendly_name}}</h4>
        {% if skill.verb %}
        <p>Verb: {{skill.verb}}&hellip;</p>
        {% endif %}
        {% if skill.desc %}
        <p>{{skill.desc}}</p>
        {% endif %}
        {% if skill.school %}
        <p>School: {{skill.school}}.</p>
        {% endif %}
        {{- macros.require_fragments(skill.need,    skill.friendly_need,    'Needs') }}
        {{- macros.require_fragments(skill.require, skill.friendly_require, 'Requires') }}
        {%- if skill.flavor %}
        <p><em>{{skill.flavor}}</em></p>
        {% endif %}
        {% if skill.cost or skill.modifier_map or skill.result %}

        <div class="stats">
          {{- macros.stats_table(skill.buy, 'Cost') }}
          {{- macros.stats_table(skill.run, 'Run') }}
          {{- macros.stats_table(skill.mod, 'Modifiers') }}
          {{- macros.stats_table(skill.effect, 'Effect') }}
          {{- macros.stats_table(skill.result, 'Result') }}
        </div>
        {% endif %}

        <details>
          <summary>Raw</summary>
          <pre><code>{{skill.formatted_raw}}</code></pre>
        </details>

      </section>
      {% endfor %}
    </section>
    {% endfor %}
  </section>
</main>

</body>
</html>